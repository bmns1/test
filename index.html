<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silicon Valley Academy Parent Portal (beta)</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script src="https://unpkg.com/phosphor-icons"></script>
    <!-- PayPal SDK - Updated for Fee Collection & Wallet Support (Apple Pay, Google Pay, Venmo) -->
    <script src="https://www.paypal.com/sdk/js?client-id=AbiIIQaGjjsKptfoxNWoHVZj8emb1OrShMOwN5CxdrirjAZ6Vz8DBRAWHSuQPdgh3RqDMySAsEmGQDH9&currency=USD&enable-funding=venmo,applepay&components=buttons"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* A softer slate-50 background */
        }
        .tab-active {
            border-bottom: 2px solid #0d9488; /* teal-600 */
            color: #0d9488; /* teal-600 */
            font-weight: 600;
        }
        .tab-content { display: none; }
        .tab-content-active { display: block; }
        #mobile-menu { display: none; }
        /* Simple animation for accordion */
        .rotate-180 { transform: rotate(180deg); }
        .transition-transform { transition: transform 0.2s ease-in-out; }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
        .student-tab-active {
            border-bottom: 3px solid #0d9488;
            color: #0d9488;
            font-weight: 600;
        }
        /* Custom Scrollbar for Agreements */
        .agreement-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .agreement-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .agreement-scroll::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        .agreement-scroll::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div id="login-container" class="min-h-screen flex items-center justify-center bg-slate-100 p-4">
        <!-- Screen 1: Main Login Choice -->
        <div id="login-screen" class="text-center p-8 bg-white rounded-xl shadow-lg max-w-md w-full">
            <img src="https://raw.githubusercontent.com/bmns1/parent-portal/main/logo.png" alt="SVA Logo" class="h-20 w-auto mx-auto mb-4">
            <h1 class="text-3xl font-bold text-slate-900 mt-4">Silicon Valley Academy</h1>
            <p class="text-lg text-slate-600 mb-6">Parent Portal (beta)</p>
            <p class="text-sm text-slate-500 mb-8">Please log in with your SVA-associated student email. For assistance or password issues, please contact: <a href="mailto:parent.portal@svaschool.org" class="font-medium text-teal-600 hover:underline">parent.portal@svaschool.org</a></p>
            
            <!-- Error Message Area -->
            <div id="login-error-msg" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6 text-left" role="alert">
                <strong class="font-bold">Login Failed:</strong>
                <span class="block sm:inline" id="login-error-text"></span>
            </div>

            <!-- Google Sign-In Button -->
            <div id="google-signin-button-container" class="flex justify-center"></div>
            
            <!-- Divider -->
            <div class="my-6 flex items-center justify-center">
                <span class="border-b border-slate-300 w-full"></span>
                <span class="mx-4 text-sm font-medium text-slate-500">OR</span>
                <span class="border-b border-slate-300 w-full"></span>
            </div>
            
            <!-- Passkey Login Form -->
            <form id="passkey-request-form" class="space-y-4">
                <div>
                    <label for="email-input" class="sr-only">Student Email</label>
                    <input type="email" id="email-input" placeholder="Enter your student email" class="w-full px-4 py-3 rounded-md border-slate-300 shadow-sm" required>
                </div>
                <button type="submit" id="request-passkey-btn" class="w-full bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-teal-700 transition">
                    Send Login Link
                </button>
            </form>
        </div>

        <!-- Screen 2: "Check Email" Screen (Hidden by default) -->
        <div id="passkey-verify-screen" class="hidden text-center p-8 bg-white rounded-xl shadow-lg max-w-md w-full">
            <img src="https://raw.githubusercontent.com/bmns1/parent-portal/main/logo.png" alt="SVA Logo" class="h-20 w-auto mx-auto mb-4">
            <h2 class="text-2xl font-bold text-slate-900">Check Your Email</h2>
            <p class="text-slate-600 my-4">A secure login link has been sent to parents email associated with the following student <strong id="passkey-email-display">your email</strong>.</p>
             <p class="text-sm text-slate-500">Please click the link in that email to log in. The link will expire in 10 minutes. You may need to check your spam folder.</p>
            
            <button type="button" id="go-back-btn" class="w-full text-sm text-slate-600 hover:text-slate-900 hover:underline mt-6">
                &larr; Go Back
            </button>
        </div>
    </div>


    <div id="loading-overlay" class="fixed inset-0 bg-slate-100 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <i id="loading-icon" class="ph-spinner-gap text-6xl text-teal-600 mx-auto animate-spin"></i>
            <h2 id="loading-title" class="text-2xl font-semibold text-slate-700 mt-4">Loading Portal Data...</h2>
            <p id="loading-message" class="text-slate-500">Please wait a moment.</p>
        </div>
    </div>
    
    <div id="portal-container" class="hidden">
        
        <!-- QR Code Modal -->
        <div id="qr-code-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 flex items-center justify-center">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Event Check-in QR Code</h3>
                    <div class="mt-2 px-7 py-3">
                        <div id="qrcode" class="mx-auto"></div>
                        <p class="text-sm text-gray-500 mt-4">Have an admin scan this code when you arrive at the event to get credit for your hours.</p>
                    </div>
                    <div class="items-center px-4 py-3">
                        <button id="close-qr-modal-btn" class="px-4 py-2 bg-teal-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-400">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RE-ENROLLMENT WIZARD MODAL -->
        <div id="enrollment-modal" class="fixed inset-0 bg-gray-800 bg-opacity-90 overflow-y-auto h-full w-full hidden z-[60] flex items-center justify-center">
             <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col my-6 mx-4">
                <!-- Header -->
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-teal-600 rounded-t-xl">
                    <h3 class="text-xl font-bold text-white">Re-enrollment 2026-2027</h3>
                    <button onclick="closeEnrollmentWizard(true)" class="text-teal-100 hover:text-white">
                        <i class="ph-x text-2xl"></i>
                    </button>
                </div>
                
                <!-- Content Area (Scrollable) -->
                <div class="flex-1 overflow-y-auto p-6" id="enrollment-wizard-content">
                    
                    <!-- Step 1: Start -->
                    <div id="step-start" class="wizard-step">
                        <h4 class="text-2xl font-bold text-slate-800 mb-4">Priority Re-enrollment</h4>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                            <p class="text-blue-800">
                                <strong>Discounted Priority Window Ends:</strong> <span id="priority-countdown" class="font-mono font-bold text-red-600">Loading...</span>
                                <br><span class="text-sm">Deadline: February 16, 2026 at 8:30am PST</span>
                            </p>
                        </div>
                        <p class="mb-4 text-slate-700">Thank you for securing your spot at Silicon Valley Academy for the 2026-2027 school year.</p>
                        <p class="mb-4 text-slate-600 text-sm">
                            This exclusive window offers priority registration for existing families.
                        </p>
                        
                        <h5 class="font-bold text-lg text-slate-800 mb-3">Select students to re-enroll:</h5>
                        <div id="enrollment-student-list" class="space-y-3 mb-6"></div>
                        <p id="enrollment-error" class="text-red-500 hidden mb-2">Please select at least one student.</p>
                        
                        <div class="text-right">
                            <button onclick="wizardNext('payment')" id="btn-goto-payment" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">Continue to Payment &rarr;</button>
                        </div>
                    </div>

                    <!-- Step 2: Payment (Simplified) -->
                    <div id="step-payment" class="wizard-step hidden">
                        <h4 class="text-2xl font-bold text-slate-800 mb-4">Registration Payment</h4>
                        
                        <div class="bg-teal-50 p-4 rounded border border-teal-200 mb-6">
                            <p class="text-sm text-teal-800 font-semibold">
                                Please complete the payment below to secure your spot. Once payment is successful, you will receive a link to finalize the enrollment process on Gradelink.
                            </p>
                        </div>

                        <div class="mb-6">
                             <h5 class="font-bold text-slate-800 mb-2">Total Due: <span id="payment-amount" class="text-teal-600">$0.00</span></h5>
                             <p class="text-sm text-slate-600 mb-4">Registration fee for <span id="payment-student-count">0</span> student(s). ($1.00 verification fee per student)</p>
                             
                             <div id="paypal-button-container"></div>
                             
                             <div id="payment-completed-msg" class="hidden bg-green-100 text-green-800 p-4 rounded-lg shadow-sm border border-green-200 text-center space-y-3">
                                 <div class="font-bold text-lg"><i class="ph-check-circle text-2xl align-middle mr-1"></i> Payment Successful!</div>
                                 <p class="text-sm">Your Payment ID: <strong id="success-payment-id" class="font-mono bg-white px-2 py-1 rounded border border-green-300 select-all"></strong></p>
                                 <p class="text-sm">Please save this ID for your records.</p>
                                 <div class="pt-2">
                                     <a href="https://secure.gradelink.com/lkg/Gradelink.xml?contenttype=text%2Fhtml&Language=English&v=1.0" target="_blank" class="inline-block bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition shadow-md">
                                         Complete Enrollment on Gradelink &rarr;
                                     </a>
                                 </div>
                             </div>
                        </div>

                        <div class="flex justify-between items-center mt-8">
                            <button onclick="wizardPrev('start')" id="btn-back-to-start" class="text-slate-500 hover:text-slate-800">Back</button>
                            <!-- Submit button is essentially replaced by PayPal completion, but we keep it for backend sync -->
                            <button onclick="submitEnrollment()" id="btn-submit-enrollment" class="hidden bg-teal-600 text-white px-8 py-3 rounded-lg hover:bg-teal-700 shadow-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed">Finalize</button>
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <div class="min-h-screen bg-slate-50">
            <header class="bg-white shadow-sm sticky top-0 z-40">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <img src="https://raw.githubusercontent.com/bmns1/parent-portal/main/logo.png" alt="SVA Logo" class="h-12 w-auto">
                            </div>
                            <div class="ml-4">
                                <h1 class="text-2xl font-bold text-slate-900">Silicon Valley Academy</h1>
                                <p class="text-sm text-slate-500">Parent Portal (beta)</p>
                            </div>
                        </div>
                        <div class="hidden sm:flex items-center">
                            <div id="user-info-desktop" class="mr-4 text-right"></div>
                            <button onclick="signOut();" class="bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition duration-300">Sign Out</button>
                        </div>
                        <div class="sm:hidden flex items-center">
                            <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-slate-500 hover:text-white hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                                <span class="sr-only">Open main menu</span>
                                <i id="menu-icon-open" class="ph-list text-2xl"></i>
                                <i id="menu-icon-close" class="ph-x text-2xl hidden"></i>
                            </button>
                        </div>
                    </div>
                </div>
                 <div class="sm:hidden" id="mobile-menu">
                    <div class="pt-4 pb-3 border-b border-slate-200">
                        <div id="user-info-mobile" class="px-5"></div>
                    </div>
                    <div id="main-nav-mobile" class="px-2 pt-2 pb-3 space-y-1"></div>
                    <div class="pt-4 pb-3 border-t border-slate-200">
                        <div class="px-2">
                             <button onclick="signOut();" class="w-full bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition duration-300">Sign Out</button>
                        </div>
                    </div>
                </div>
            </header>

            <nav class="hidden sm:block bg-white border-b border-slate-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div id="main-nav" class="flex justify-center -mb-px">
                        <button class="tab-btn tab-active text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="dashboard"><i class="ph-house mr-2"></i>Student Dashboard</button>
                        <!-- NEW ENROLLMENT TAB -->
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="enrollment"><i class="ph-student mr-2"></i>Enrollment</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="actions"><i class="ph-bell-ringing mr-2"></i>Actions</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="volunteering"><i class="ph-hands-clapping mr-2"></i>Volunteering</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="signups"><i class="ph-list-checks mr-2"></i>My Signups</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="pto"><i class="ph-users-three mr-2"></i>PTO</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="faq-forms"><i class="ph-link mr-2"></i>Resources</button>
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="live-event"><i class="ph-video-camera-fill mr-2"></i>Live Events</button>  
                        <button class="tab-btn text-slate-600 hover:text-teal-600 py-4 px-5 block focus:outline-none text-sm font-medium" data-tab="calendar"><i class="ph-calendar mr-2"></i>Calendar</button>
                    </div>
                </div>
            </nav>

            <main class="max-w-7xl mx-auto py-8 sm:py-10 px-4 sm:px-6 lg:px-8">
                <div id="dashboard" class="tab-content tab-content-active">
                     <h2 class="text-3xl font-bold text-slate-900 mb-6">My Students</h2>
                    <div id="student-content-container" class="space-y-12"></div>
                </div>

                <!-- 2. NEW ENROLLMENT TAB CONTENT -->
                <div id="enrollment" class="tab-content">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Priority Re-enrollment 2026-2027</h2>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="p-6 md:p-8">
                            <!-- STEP 1: SELECT & START -->
                            <div id="enrollment-step-start">
                                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                                    <p class="text-blue-800">
                                        <strong>Discounted Priority Window Ends:</strong> <span id="priority-countdown" class="font-mono font-bold text-red-600">Loading...</span>
                                        <br><span class="text-sm">Deadline: February 16, 2026 at 8:30am PST</span>
                                    </p>
                                </div>
                                <p class="mb-4 text-slate-700">Thank you for securing your spot at Silicon Valley Academy for the 2026-2027 school year. This exclusive window offers priority registration for existing families.</p>
                                
                                <h5 class="font-bold text-lg text-slate-800 mb-3">Your Students:</h5>
                                <div id="enrollment-student-list" class="space-y-3 mb-6"></div>
                                <p id="enrollment-error" class="text-red-500 hidden mb-2 font-bold"><i class="ph-warning"></i> Please select at least one student to continue.</p>
                                
                                <div class="mt-6 pt-6 border-t border-slate-100 flex justify-end">
                                    <button onclick="wizardNext('payment')" id="btn-goto-payment" class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 font-bold shadow-md transition transform hover:-translate-y-0.5">Continue to Payment &rarr;</button>
                                </div>
                            </div>

                            <!-- STEP 2: PAYMENT -->
                            <div id="enrollment-step-payment" class="hidden">
                                <button onclick="wizardPrev('start')" class="text-slate-500 hover:text-slate-800 mb-4 flex items-center text-sm font-medium"><i class="ph-arrow-left mr-1"></i> Back to Selection</button>
                                
                                <h4 class="text-2xl font-bold text-slate-800 mb-2">Registration Payment</h4>
                                <div class="bg-teal-50 p-4 rounded border border-teal-200 mb-6">
                                    <p class="text-sm text-teal-800 font-semibold">
                                        Please complete the payment below to secure your spot. Once payment is successful, the system will record your enrollment and you can proceed to Gradelink to finalize forms.
                                    </p>
                                </div>

                                <div class="max-w-md mx-auto">
                                     <div class="text-center mb-6">
                                        <h5 class="font-bold text-slate-800 text-xl mb-1">Total Due: <span id="payment-amount" class="text-teal-600">$0.00</span></h5>
                                        <p class="text-sm text-slate-500">Registration fee for <span id="payment-student-count">0</span> student(s).<br>($1.00 verification fee per student)</p>
                                     </div>
                                     
                                     <div id="paypal-button-container"></div>
                                     
                                     <div id="payment-completed-msg" class="hidden bg-green-100 text-green-800 p-6 rounded-xl shadow-md border border-green-200 text-center space-y-4">
                                         <div class="font-bold text-xl"><i class="ph-check-circle text-3xl align-middle mr-2 text-green-600"></i> Payment Successful!</div>
                                         <div class="text-sm bg-white p-3 rounded border border-green-200">
                                            Payment ID: <strong id="success-payment-id" class="font-mono text-slate-700 select-all"></strong>
                                         </div>
                                         <p class="text-sm">We have recorded your priority registration. Please proceed to Gradelink to complete the required forms.</p>
                                         <div class="pt-2">
                                             <a href="https://secure.gradelink.com/lkg/Gradelink.xml?contenttype=text%2Fhtml&Language=English&v=1.0" target="_blank" class="inline-flex items-center justify-center w-full bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition shadow-lg">
                                                 Complete on Gradelink <i class="ph-arrow-square-out ml-2"></i>
                                             </a>
                                         </div>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="actions" class="tab-content">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Actions</h2>
                    <!-- Added id to container for easy injection -->
                    <div id="actions-content-container" class="space-y-10"></div>
                </div>
                
                <!-- ... Other tabs (volunteering, signups, pto, faq, etc.) same as before ... -->
                <div id="volunteering" class="tab-content">
                     <h2 class="text-3xl font-bold text-slate-900 mb-6">Volunteering Opportunities</h2>
                    <div class="mb-6 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-2">Volunteering Objectives & Rules</h3>
                        <p class="text-slate-600 text-sm">
                            Our parent volunteer program is essential to the success of our school community. The primary objective is to foster a strong partnership between parents and the school, enriching our students' educational experience. We require each family to complete a set number of volunteer hours per school year, divided between two semesters. Please sign up for opportunities that match your interests and schedule. If you must withdraw from a commitment, please do so at least three weeks in advance to allow another parent to take the spot. Failure to show up for a signed-up event without prior cancellation will result in a penalty, increasing your total required hours. For safety reasons, we ask that you do not bring small children while volunteering. We recommend arranging childcare during your volunteer shift. Thank you for your dedication to our students and school!
                        </p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="filter-semester" class="block text-sm font-medium text-slate-700">Semester</label>
                                <select id="filter-semester" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option value="all">All</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-event" class="block text-sm font-medium text-slate-700">Filter by Event</label>
                                <select id="filter-event" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option value="all">All Events</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-time" class="block text-sm font-medium text-slate-700">Time of Day</label>
                                <select id="filter-time" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option>All</option>
                                    <option>Morning</option>
                                    <option>Afternoon</option>
                                    <option>Evening</option>
                                    <option>All Day</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-hours" class="block text-sm font-medium text-slate-700">Max Hours</label>
                                <select id="filter-hours" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option value="99">Any</option>
                                    <option value="2">Up to 2</option>
                                    <option value="4">Up to 4</option>
                                    <option value="8">Up to 8</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-location" class="block text-sm font-medium text-slate-700">Location</label>
                                <select id="filter-location" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option>All</option>
                                    <option>On-Campus</option>
                                    <option>Remote</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-sort" class="block text-sm font-medium text-slate-700">Sort By</label>
                                <select id="filter-sort" class="filter-control mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                                    <option value="default">Default</option>
                                    <option value="recent">Recently Added</option>
                                </select>
                            </div>
                        </div>
                    </div>
                     <div id="volunteering-list" class="space-y-6"><p>Loading volunteering opportunities...</p></div>
                </div>
                <div id="signups" class="tab-content"><h2 class="text-3xl font-bold text-slate-900 mb-6">My Volunteer Hours</h2><div id="my-signups-content"></div></div>
                <div id="pto" class="tab-content">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Parent-Teacher Organization (PTO)</h2>
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-teal-700 mb-2">Building a Strong School Community Together</h3>
                            <p class="text-slate-600 leading-relaxed">As-salamu alaykum! The SVA Parent-Teacher Organization (PTO) warmly welcomes all new and returning families. We believe that a high level of parent participation is critical to the success of our students' education, tarbiyah, and development. The PTO is a formal, volunteer-based organization of parents, teachers, and staff working together to enhance the SVA student experience.</p>
                        </div>
                        <div class="border-t border-slate-200 pt-6">
                            <h3 class="text-xl font-semibold text-teal-700 mb-3">Our Mission & Key Roles</h3>
                            <ul class="list-disc list-inside space-y-3 text-slate-600">
                                <li><strong>Organize Enriching Events:</strong> We plan and execute co-curricular events and activities like International Day, Book Fairs, Movie Nights, and the Hajj Simulation to enrich our children's education.</li>
                                <li><strong>Raise Funds:</strong> Through community efforts, we raise funds to support vital school programs, classroom needs, and new initiatives.</li>
                                <li><strong>Build Community:</strong> We strive to create a strong, collaborative, and supportive environment that connects parents, teachers, and staff.</li>
                                <li><strong>Shape the Educational Experience:</strong> The PTO provides a valuable opportunity for parents to have a voice and actively contribute to their children's journey at SVA.</li>
                            </ul>
                        </div>
                         <div class="border-t border-slate-200 pt-6">
                            <h3 class="text-xl font-semibold text-teal-700 mb-2">Get Involved</h3>
                            <p class="text-slate-600 mb-4">Every parent and guardian at SVA is automatically a member of the PTO! We encourage you to get involved. You can sign up to be a committee member for a specific event or support year-long school programs.</p>
                            <div class="bg-teal-50 p-5 rounded-lg border border-teal-200">
                                <h4 class="font-semibold text-slate-800">2025-26 PTO Volunteering Leads:</h4>
                                <ul class="list-disc list-inside mt-2 text-slate-700">
                                    <li>Sara M.</li>
                                    <li>Rubeka A.</li>
                                    <li>Esraa El T.</li>
                                    <li>Ahmed S.</li>
                                </ul>
                                <p class="mt-4 text-sm">Interested in becoming a PTO lead, helping out, or have a question? To reach the PTO leadership, please email <a href="mailto:pto@svamail.com" class="text-teal-600 font-semibold hover:underline">pto@svamail.com</a>.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="faq-forms" class="tab-content"><h2 class="text-3xl font-bold text-slate-900 mb-6">Resources</h2><div id="faq-content"></div></div>
                <div id="live-event" class="tab-content"></div>
                <div id="calendar" class="tab-content"><h2 class="text-3xl font-bold text-slate-900 mb-6">Calendar</h2><div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden"><iframe src="https://calendar.google.com/calendar/embed?src=svaschool.org_us4ga4j1cfs27epj0f2dfegcl0%40group.calendar.google.com&ctz=America/Los_Angeles" style="border: 0" width="100%" height="600" frameborder="0" scrolling="no"></iframe></div></div>
            </main>
            
            <footer class="bg-white mt-12 border-t border-slate-200">
                 <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-slate-500 text-sm"><p>&copy; 2025 BMNS. All Rights Reserved - (parent.portal@svaschool.org)</p></div>
            </footer>
        </div>
    </div>
    
    <script>
        // --- CONFIGURATION ---
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwQWDkjjXqT7V2x4N3ea9IvqBbvI7QJ2qaMLVyXbpg2pBJxsVl_5r00kaLZXJNDw_mw/exec';
        const NEWSLETTER_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxdZkNNppgbr_FdH2FOAztYpujc9A4URAsQIlWnADSypDlb5_KnCiVP3EImRK96jWK3Yg/exec';
        const CLIENT_ID = "14216824305-v19ecsmrhk1muaglrlhjceqjk5oeqr4n.apps.googleusercontent.com";
        let ID_TOKEN = null;
        let portalData = {};
        let enrollmentState = { selectedStudents: [], totalAmount: 0, paymentID: null };

        // --- ENROLLMENT TAB LOGIC ---
        function renderEnrollmentTab() {
            startCountdown();
            populateStudentSelection();
        }

        function startCountdown() {
            const dest = new Date("Feb 16, 2026 08:30:00").getTime();
            const el = document.getElementById("priority-countdown");
            if(!el) return;
            
            const x = setInterval(function() {
                const now = new Date().getTime();
                const diff = dest - now;
                if (diff < 0) {
                    clearInterval(x);
                    el.innerHTML = "Priority Window Closed";
                    el.className = "font-mono font-bold text-gray-500";
                } else {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    el.innerHTML = days + "d " + hours + "h " + minutes + "m";
                }
            }, 1000);
        }

        function populateStudentSelection() {
            const container = document.getElementById('enrollment-student-list');
            if(!container) return;
            container.innerHTML = '';
            
            if (!portalData.students || portalData.students.length === 0) {
                container.innerHTML = '<p class="text-slate-500">No students found.</p>';
                return;
            }

            portalData.students.forEach(s => {
                const details = s.enrollmentDetails || {};
                const isEnrolled = details.timestamp && String(details.timestamp).trim() !== '';
                
                const div = document.createElement('div');
                div.className = `flex items-center p-4 border rounded-lg transition-all ${isEnrolled ? 'bg-green-50 border-green-200 shadow-sm' : 'bg-white hover:bg-slate-50 border-slate-200 cursor-pointer'}`;
                
                let badge = '';
                if (isEnrolled) {
                     badge = `
                        <div class="ml-auto text-right">
                             <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="ph-check-circle mr-1"></i> Paid</span>
                             <div class="text-xs text-slate-500 mt-1">Ref: ${details.paymentid || 'N/A'}</div>
                             <a href="https://secure.gradelink.com/lkg/Gradelink.xml?contenttype=text%2Fhtml&Language=English&v=1.0" target="_blank" class="block mt-2 text-teal-600 text-xs font-bold hover:underline">Complete on Gradelink &rarr;</a>
                        </div>
                     `;
                }

                div.innerHTML = `
                    <label class="flex items-center w-full ${isEnrolled ? 'cursor-default' : 'cursor-pointer'}">
                        <input type="checkbox" class="enroll-student-check form-checkbox h-5 w-5 text-teal-600 rounded focus:ring-teal-500 transition duration-150 ease-in-out" value="${s.uniqueStudentId}" ${isEnrolled ? 'disabled checked' : 'checked'}>
                        <div class="ml-4 flex-grow">
                            <span class="block font-bold text-slate-800 text-lg">${s.studentName}</span>
                            <span class="block text-slate-500 text-sm">Next Grade: ${details.nextgradelevel || 'N/A'}</span>
                        </div>
                        ${badge}
                    </label>
                `;
                container.appendChild(div);
            });
            
            // Check if ALL eligible students are enrolled to hide the continue button
            const allEnrolled = portalData.students.every(s => s.enrollmentDetails && s.enrollmentDetails.timestamp && String(s.enrollmentDetails.timestamp).trim() !== '');
            if (allEnrolled) {
                const msg = document.createElement('div');
                msg.className = "bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded mb-4";
                msg.innerHTML = '<p class="font-bold">All Set!</p><p>All eligible students have verified payments. Please complete any remaining forms on Gradelink.</p>';
                container.prepend(msg);
                document.getElementById('btn-goto-payment').style.display = 'none';
            } else {
                document.getElementById('btn-goto-payment').style.display = 'inline-block';
            }
        }

        function wizardNext(stepId) {
            if (stepId === 'payment') {
                const selected = document.querySelectorAll('.enroll-student-check:checked:not(:disabled)');
                if (selected.length === 0) {
                    document.getElementById('enrollment-error').classList.remove('hidden');
                    return;
                }
                enrollmentState.selectedStudents = Array.from(selected).map(cb => cb.value);
                document.getElementById('enrollment-error').classList.add('hidden');

                // Calculate Amount
                enrollmentState.totalAmount = enrollmentState.selectedStudents.length * 1.00;
                document.getElementById('payment-student-count').textContent = enrollmentState.selectedStudents.length;
                document.getElementById('payment-amount').textContent = `$${enrollmentState.totalAmount.toFixed(2)}`;
                
                // Show/Hide divs
                document.getElementById('enrollment-step-start').classList.add('hidden');
                document.getElementById('enrollment-step-payment').classList.remove('hidden');
                
                // Render Buttons
                renderPayPalButton();
            }
        }
        
        function wizardPrev(stepId) {
            if (stepId === 'start') {
                document.getElementById('enrollment-step-payment').classList.add('hidden');
                document.getElementById('enrollment-step-start').classList.remove('hidden');
                // Reset state
                enrollmentState.paymentID = null;
                document.getElementById('payment-completed-msg').classList.add('hidden');
                document.getElementById('paypal-button-container').classList.remove('hidden');
                populateStudentSelection(); // Refresh list
            }
        }

        function renderPayPalButton() {
            const container = document.getElementById('paypal-button-container');
            container.innerHTML = ''; // Clear previous
            
            paypal.Buttons({
                style: {
                    shape: 'rect',
                    color: 'gold',
                    layout: 'vertical',
                    label: 'pay'
                },
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: { value: enrollmentState.totalAmount.toFixed(2) },
                            description: "SVA Enrollment Fee Collection"
                        }],
                        application_context: {
                            shipping_preference: 'NO_SHIPPING',
                            brand_name: 'Silicon Valley Academy'
                        }
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // 1. UI Update
                        enrollmentState.paymentID = details.id;
                        document.getElementById('success-payment-id').textContent = details.id;
                        document.getElementById('paypal-button-container').classList.add('hidden');
                        document.getElementById('payment-completed-msg').classList.remove('hidden');
                        
                        // 2. Backend Call
                        submitEnrollment();
                    });
                }
            }).render('#paypal-button-container');
        }

        function submitEnrollment() {
            const selectedStudentObjs = portalData.students.filter(s => enrollmentState.selectedStudents.includes(String(s.uniqueStudentId)));
            
            fetch(WEB_APP_URL, {
                method: 'POST', mode: 'no-cors',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: 'enrollmentSubmit', token: ID_TOKEN,
                    students: selectedStudentObjs,
                    contactStatus: 'Skipped', 
                    volunteerS1: false, 
                    volunteerS2: false, 
                    paymentPlan: 'NotSelected', 
                    paymentID: enrollmentState.paymentID,
                    initials: 'N/A'
                })
            }).then(() => {
                console.log("Enrollment recorded. Refreshing data...");
                // Force data refresh so if they go back or reload, it's updated
                fetchData(ID_TOKEN); 
            }).catch(err => console.error("Enrollment Submission Error:", err));
        }

        // --- STANDARD APP LOGIC ---
        function closeModal(modalId) { document.getElementById(modalId).classList.add('hidden'); }
        function openModal(modalId) { document.getElementById(modalId).classList.remove('hidden'); }
        function showLoginScreen(screenId) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('passkey-verify-screen').classList.add('hidden');
            if (document.getElementById(screenId)) document.getElementById(screenId).classList.remove('hidden');
        }
        function formatDate(dateString) { if (!dateString) return 'N/A'; const date = new Date(dateString); return !isNaN(date.getTime()) ? date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : dateString; }
        function decodeGrade(grade) { const gradeStr = String(grade).toUpperCase(); if (gradeStr === 'P') return 'Pre-K'; if (gradeStr === '0' || gradeStr === 'K' ) return 'KG'; return `Grade ${gradeStr}`; }
        
        function switchToTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('tab-active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('tab-content-active'));
            document.querySelectorAll(`.tab-btn[data-tab="${tabName}"]`).forEach(b => b.classList.add('tab-active'));
            document.getElementById(tabName).classList.add('tab-content-active');
            
            // Special initialization for specific tabs
            if (tabName === 'enrollment') {
                renderEnrollmentTab();
            }
            
            const mobileMenu = document.getElementById('mobile-menu');
            if(mobileMenu.style.display === 'block'){
                mobileMenu.style.display = 'none';
                document.getElementById('menu-icon-open').classList.remove('hidden');
                document.getElementById('menu-icon-close').classList.add('hidden');
            }
        }
        
        function switchToTabAndSubTab(mainTabId, subTabId) {
            switchToTab(mainTabId);
            document.querySelectorAll('.faq-forms-tab-btn').forEach(btn => { btn.classList.remove('tab-active'); btn.classList.add('text-slate-500'); });
            const subTabButton = document.querySelector(`.faq-forms-tab-btn[data-tab="${subTabId}"]`);
            if (subTabButton) { subTabButton.classList.add('tab-active'); subTabButton.classList.remove('text-slate-500'); }
            document.querySelectorAll('.faq-forms-tab-content').forEach(content => content.classList.add('hidden'));
            const subTabContent = document.getElementById(subTabId);
            if (subTabContent) subTabContent.classList.remove('hidden');
        }

        // --- FETCH DATA ---
        function fetchData(token) {
            fetch(`${WEB_APP_URL}?token=${token}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading-overlay').classList.add('hidden');
                    if (data.status !== 'success' || !data.data) {
                        if (data.error && data.error.includes("Authentication failed")) return handleTokenExpired(data.error);
                        throw new Error(data.error || 'Invalid data.');
                    }
                    portalData = data.data;
                    document.getElementById('portal-container').classList.remove('hidden');
                    renderDashboard(portalData.students);
                    renderActionsTab(portalData.students);
                    renderEnrollmentTab(); // Pre-populate enrollment tab
                    populateEventFilter(portalData.allEvents);
                    applyAndRenderFilters(); 
                    renderMySignups(portalData.volunteerProgress);
                    renderMySignupsList(portalData.mySignups);
                    renderMobileMenu();
                    if (typeof phosphor !== 'undefined') phosphor.replace();
                })
                .catch(error => { console.error('Fetch Error:', error); handleTokenExpired(error.message); });
        }
        
        // --- DASHBOARD RENDERER ---
        function renderDashboard(students) {
            const contentContainer = document.getElementById('student-content-container');
            contentContainer.innerHTML = ''; 
            if (!students || students.length === 0) {
                contentContainer.innerHTML = '<div class="bg-white p-6 rounded-lg shadow-sm"><p class="text-center text-slate-600">No students found for this parent account.</p></div>';
                return;
            }
            students.forEach(student => {
                if (!student || !student.studentName) {
                    contentContainer.innerHTML += `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert"><p class="font-bold">Data Issue</p><p>An incomplete student record was found. Please check your 'Students' Google Sheet for any blank rows and delete them.</p></div>`;
                    return;
                }
                const studentCard = document.createElement('div');
                let teachersHtml = '';
                if (student.teachers && student.teachers.length > 0) {
                    const visibleTeachers = student.teachers.slice(0, 3);
                    const hiddenTeachers = student.teachers.slice(3);
                    
                    const renderTeacher = (t) => {
                        // Replaced placeholder image for teachers with initials div
                        const initials = t.teacherName ? t.teacherName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : 'T';
                        return `
                        <li class="flex items-center justify-between py-3 border-b border-slate-100 last:border-b-0">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full mr-4 bg-slate-200 text-slate-500 flex items-center justify-center font-bold text-xs border border-slate-300">
                                    ${t.photoUrl && !t.photoUrl.includes('placehold') ? `<img src="${t.photoUrl}" class="h-full w-full rounded-full object-cover">` : initials}
                                </div>
                                <div>
                                    <p class="font-semibold text-slate-800">${t.teacherName}</p>
                                    <p class="text-sm text-slate-500">${t.role}</p>
                                </div>
                            </div>
                            <a href="mailto:${t.email}" class="text-teal-600 hover:underline text-sm font-medium">${t.email}</a>
                        </li>`;
                    };

                    teachersHtml = visibleTeachers.map(renderTeacher).join('');
                    if (hiddenTeachers.length > 0) {
                        teachersHtml += `<div id="more-teachers-${student.uniqueStudentId}" class="hidden space-y-0">`;
                        teachersHtml += hiddenTeachers.map(renderTeacher).join('');
                        teachersHtml += `</div>`;
                        teachersHtml += `<div class="pt-3"><button data-student-id="${student.uniqueStudentId}" class="show-more-teachers-btn text-teal-600 font-semibold w-full text-center hover:underline text-sm p-2">Show More</button></div>`;
                    }
                } else {
                    teachersHtml = '<li><p class="text-slate-500 py-3">No teachers listed for this student.</p></li>';
                }

                let eventsHtml = '';
                if (student.events && student.events.length > 0) {
                    const today = new Date(); today.setHours(0, 0, 0, 0);
                    const upcomingEvents = student.events.filter(event => new Date(event.date) >= today);
                    const visibleEvents = upcomingEvents.slice(0, 4);
                    const hiddenEvents = upcomingEvents.slice(4);
                    eventsHtml = visibleEvents.map((event, index) => renderEventItem(event, student, index)).join('');
                    if (hiddenEvents.length > 0) {
                        eventsHtml += `<div id="more-events-${student.uniqueStudentId}" class="hidden space-y-4">` + hiddenEvents.map((event, index) => renderEventItem(event, student, index + 4)).join('') + `</div>`;
                        eventsHtml += `<div class="border-t border-slate-100 pt-3 mt-3"><button data-student-id="${student.uniqueStudentId}" class="show-more-events-btn text-teal-600 font-semibold w-full text-center hover:underline text-sm p-2">Show More</button></div>`;
                    }
                } else {
                    eventsHtml = '<li><p class="text-slate-500 py-3">No upcoming events for this student.</p></li>';
                }

                // Generate initials for student avatar
                const studentInitials = student.studentName ? student.studentName.split(" ").map(n=>n[0]).join("").substring(0,2).toUpperCase() : "ST";
                
                studentCard.innerHTML = `
                <div class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
                    <div class="p-6 bg-slate-50 border-b border-slate-200">
                        <div class="flex items-center">
                            <div class="h-16 w-16 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-2xl border border-indigo-200 shadow-inner">
                                ${studentInitials}
                            </div>
                            <div class="ml-4">
                                <h3 class="text-2xl font-bold text-slate-900">${student.studentName}</h3>
                                <p class="text-slate-600">${decodeGrade(student.grade)} - Classroom ${student.classroom || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3">
                        <div class="lg:col-span-2 p-6">
                            <div class="mb-8">
                                <h4 class="font-semibold text-lg text-slate-700 mb-3">Quick Actions</h4>
                                <div class="flex flex-wrap gap-3">
                                    <button data-student-id="${student.uniqueStudentId}" class="report-absence-nav-btn inline-flex items-center bg-teal-100 text-teal-800 font-semibold py-2 px-4 rounded-lg hover:bg-teal-200 transition-colors">Report Absence/Tardy</button>
                                    <button onclick="switchToTabAndSubTab('faq-forms', 'quicklinks-content');" class="inline-flex items-center bg-slate-100 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-200 transition-colors">View Student Handbook</button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-lg text-slate-700 mb-2">Teachers</h4>
                                <ul class="space-y-0 divide-y divide-slate-100">${teachersHtml}</ul>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-6 lg:border-l border-slate-200">
                            <h4 class="font-semibold text-lg text-slate-700 mb-2">Upcoming Events</h4>
                            <ul class="space-y-4">${eventsHtml}</ul>
                        </div>
                    </div>
                </div>`;
                contentContainer.appendChild(studentCard);
            });
        }

        function renderEventItem(event, student, index) {
            const volunteerStatusColor = event.totalSignedUp >= event.totalNeeded ? 'text-green-600' : 'text-orange-600';
            const volunteerText = (event.totalNeeded > 0) ? `<p class="text-xs font-semibold ${volunteerStatusColor}">Volunteers: ${event.totalSignedUp} of ${event.totalNeeded}</p>` : '';
            const volunteerButtonHtml = (event.totalNeeded > event.totalSignedUp) ? `<button type="button" class="volunteer-for-event-btn w-full text-sm bg-teal-100 text-teal-800 font-semibold py-1 px-3 rounded-lg hover:bg-teal-200 transition-colors" data-event-id="${event.id}">Volunteer</button>` : '';
            return `<li class="flex justify-between items-start">
                <div class="flex-1 pr-2">
                    <p class="font-semibold text-slate-800">${event.name}</p>
                    <p class="text-sm text-slate-500">${formatDate(event.date)}</p>
                    ${volunteerText}
                </div>
                <div class="flex flex-col space-y-2 items-end w-24">
                    ${volunteerButtonHtml}
                    <div class="relative inline-block text-left w-full">
                        <button type="button" class="add-to-calendar-btn w-full inline-flex items-center justify-center rounded-md border border-slate-300 shadow-sm px-3 py-1 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none" data-event-name="${event.name}" data-event-date="${event.date}"><i class="ph-plus-circle mr-1"></i> Add</button>
                        <div class="event-dropdown origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                            <div class="py-1">
                                <a href="#" class="google-cal-link text-slate-700 block px-4 py-2 text-sm hover:bg-slate-100">Google Calendar</a>
                                <a href="#" class="ical-link text-slate-700 block px-4 py-2 text-sm hover:bg-slate-100">iCal/Outlook</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>`;
        }
        
        function renderActionsTab(students) {
             // Basic Actions Tab Content - Enrollment card removed from here as it's now a tab
             document.getElementById('actions-content-container').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"><h3 class="text-lg font-bold text-slate-800 mb-2">Absence Reporting</h3><p class="text-slate-600 mb-4">Quickly report an absence or tardy for your child.</p><button onclick="document.querySelector('.report-absence-nav-btn').click()" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700">Report Now</button></div>`;
             // Add absence form injection logic if needed here or rely on the dashboard button
        }
        
        function renderMobileMenu() {
            const desktopNav = document.getElementById('main-nav');
            const mobileNavContainer = document.getElementById('main-nav-mobile');
            mobileNavContainer.innerHTML = "";
            desktopNav.querySelectorAll('.tab-btn').forEach(button => {
                const newBtn = button.cloneNode(true);
                newBtn.classList.remove('py-4', 'px-5', 'text-sm');
                newBtn.classList.add('block', 'px-3', 'py-2', 'rounded-md', 'text-base', 'font-medium');
                mobileNavContainer.appendChild(newBtn);
            });
        }
        
        function handleTokenExpired(message) { localStorage.removeItem('sva_id_token'); ID_TOKEN = null; document.getElementById('loading-overlay').classList.add('hidden'); document.getElementById('portal-container').classList.add('hidden'); document.getElementById('login-container').classList.remove('hidden'); document.getElementById('login-error-text').textContent = message; document.getElementById('login-error-msg').classList.remove('hidden'); }
        function handleLoginSuccess(idToken) { 
            ID_TOKEN = idToken; 
            localStorage.setItem('sva_id_token', idToken); 
            document.getElementById('login-container').classList.add('hidden'); 
            document.getElementById('loading-overlay').classList.remove('hidden'); 
            const profile = JSON.parse(atob(ID_TOKEN.split('.')[1])); 
            
            // Replaced external placeholder with a simple UI element
            let profileImageHtml;
            if (profile.picture) {
                profileImageHtml = `<img class="h-8 w-8 rounded-full" src="${profile.picture}" alt="">`;
            } else {
                const initial = profile.email ? profile.email[0].toUpperCase() : '?';
                profileImageHtml = `<div class="h-8 w-8 rounded-full bg-teal-100 text-teal-600 flex items-center justify-center font-bold text-sm border border-teal-200">${initial}</div>`;
            }

            const name = profile.name || profile.email;
            const userInfoHtml = `<div class="flex items-center">${profileImageHtml}<div class="ml-3"><div class="text-base font-medium text-slate-800">${name}</div><div class="text-sm font-medium text-slate-500">${profile.email}</div></div></div>`;
            document.getElementById('user-info-desktop').innerHTML = userInfoHtml; 
            document.getElementById('user-info-mobile').innerHTML = userInfoHtml; 
            
            fetchData(ID_TOKEN); 
            fetchAndRenderResources(); 
            addEventListeners(); 
        }
        function signOut() { google.accounts.id.disableAutoSelect(); localStorage.removeItem('sva_id_token'); window.location.href = window.location.pathname; }
        
        function handleCredentialResponse(response) { handleLoginSuccess(response.credential); }
        
        window.onload = function() {
            const hashToken = window.location.hash.startsWith('#token=') ? window.location.hash.substring(7) : null;
            const storedToken = localStorage.getItem('sva_id_token');
            if (hashToken) { window.history.replaceState({}, document.title, window.location.pathname); handleLoginSuccess(hashToken); }
            else if (storedToken) { handleLoginSuccess(storedToken); }
            else { try { google.accounts.id.initialize({ client_id: CLIENT_ID, callback: handleCredentialResponse }); google.accounts.id.renderButton(document.getElementById('google-signin-button-container'), { theme: "outline", size: "large", width: "300" }); document.getElementById('passkey-request-form').addEventListener('submit', handleRequestPasskey); document.getElementById('go-back-btn').addEventListener('click', () => showLoginScreen('login-screen')); } catch (e) { console.error(e); } }
        };

        function handleRequestPasskey(e) {
            e.preventDefault();
            const emailInput = document.getElementById('email-input');
            const email = emailInput.value;
            const button = document.getElementById('request-passkey-btn');
            button.disabled = true; button.textContent = 'Sending...';
            fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify({ action: 'requestLoginPasskey', email: email }) })
            .then(() => { document.getElementById('passkey-email-display').textContent = email; showLoginScreen('passkey-verify-screen'); })
            .catch(err => { console.error(err); alert(`Error. Try again.`); })
            .finally(() => { button.disabled = false; button.textContent = 'Send Login Link'; });
        }
        
        // Add Event Listeners Function
        function addEventListeners() {
            document.body.addEventListener('click', function(event) {
                const target = event.target;
                const button = target.closest('button');
                if (button && button.matches('.tab-btn')) { switchToTab(button.dataset.tab); }
                if (target.closest('#mobile-menu-button')) { const m = document.getElementById('mobile-menu'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
                
                // Show More Logic
                if (button && (button.matches('.show-more-events-btn') || button.matches('.show-more-teachers-btn'))) {
                    const studentId = button.dataset.studentId;
                    const type = button.matches('.show-more-events-btn') ? 'events' : 'teachers';
                    const moreDiv = document.getElementById(`more-${type}-${studentId}`);
                    if (moreDiv) {
                        const isHidden = moreDiv.classList.contains('hidden');
                        moreDiv.classList.toggle('hidden');
                        button.textContent = isHidden ? 'Show Less' : 'Show More';
                    }
                }
                
                if (button && button.matches('.volunteer-for-event-btn')) {
                    const eventId = button.dataset.eventId;
                    switchToTab('volunteering');
                    const eventFilter = document.getElementById('filter-event');
                    if(eventFilter) {
                        eventFilter.value = eventId;
                        applyAndRenderFilters();
                    }
                }
            });
            
             document.body.addEventListener('change', function(event) {
                if (event.target.matches('.filter-control')) {
                    applyAndRenderFilters();
                }
            });
        }

        // --- VOLUNTEERING FUNCTIONS ---
        
        function populateEventFilter(events) {
            const eventFilter = document.getElementById('filter-event');
            if (!eventFilter || !events) return;
            const uniqueEvents = new Map();
            events.forEach(event => { if (event.id && !uniqueEvents.has(event.id)) uniqueEvents.set(event.id, event.name); });
            
            // Clear existing options except 'All'
            while (eventFilter.options.length > 1) eventFilter.remove(1);
            
            uniqueEvents.forEach((name, id) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = name;
                eventFilter.appendChild(option);
            });
        }

        function applyAndRenderFilters() {
            if (!portalData.volunteering || !document.getElementById('filter-time')) {
                if(portalData.volunteering) renderVolunteering(portalData.volunteering);
                return;
            }
            
            const signedUpOppIds = portalData.mySignups ? portalData.mySignups.filter(signup => signup.status !== 'Withdrawn').map(signup => signup.opportunityId) : [];
            let filteredOpportunities = [...portalData.volunteering];
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            filteredOpportunities = filteredOpportunities.filter(opp => new Date(opp.date) >= today);
            
            const eventFilterValue = document.getElementById('filter-event').value;
            const semesterFilter = document.getElementById('filter-semester').value;
            const timeFilter = document.getElementById('filter-time').value;
            const hoursFilter = parseInt(document.getElementById('filter-hours').value, 10);
            const locationFilter = document.getElementById('filter-location').value;
            const sortFilter = document.getElementById('filter-sort').value;
            
            if (eventFilterValue !== 'all') filteredOpportunities = filteredOpportunities.filter(opp => opp.eventid === eventFilterValue);
            if (semesterFilter !== 'all') filteredOpportunities = filteredOpportunities.filter(opp => String(opp.semester) === semesterFilter);
            if (timeFilter !== 'All') filteredOpportunities = filteredOpportunities.filter(opp => opp.timeOfDay === timeFilter);
            if (hoursFilter !== 99) filteredOpportunities = filteredOpportunities.filter(opp => opp.hours <= hoursFilter);
            if (locationFilter !== 'All') filteredOpportunities = filteredOpportunities.filter(opp => opp.locationType === locationFilter);
            
            // Filter out signed up opportunities
            filteredOpportunities = filteredOpportunities.filter(opp => !signedUpOppIds.includes(opp.id));
            
            if (sortFilter === 'recent') {
                filteredOpportunities.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
            } else {
                // Default sort by date
                filteredOpportunities.sort((a, b) => new Date(a.date) - new Date(b.date));
            }
            
            renderVolunteering(filteredOpportunities);
        }
        
        function renderVolunteering(opportunities) {
            const list = document.getElementById('volunteering-list');
            if(!list) return;
            list.innerHTML = '';
            
            if (!opportunities || opportunities.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 bg-white p-6 rounded-lg shadow-sm border border-slate-200">No volunteering opportunities match your current filters.</div>';
                return;
            }
            
            const groupedByEvent = opportunities.reduce((acc, opp) => {
                const eventName = portalData.allEvents.find(e => e.id === opp.eventid)?.name || 'General Opportunities';
                if (!acc[eventName]) { acc[eventName] = []; }
                acc[eventName].push(opp);
                return acc;
            }, {});
            
            Object.keys(groupedByEvent).forEach((eventName, index) => {
                const opportunitiesInEvent = groupedByEvent[eventName];
                const groupedByTitle = opportunitiesInEvent.reduce((acc, opp) => {
                    const key = opp.title;
                    if (!acc[key]) { acc[key] = { ...opp, timeSlots: [] }; }
                    acc[key].timeSlots.push(opp);
                    return acc;
                }, {});
                
                const eventContentHtml = Object.values(groupedByTitle).map(group => {
                    const timeSlotsHtml = group.timeSlots.map(slot => `
                        <div class="flex justify-between items-center border-t border-slate-100 py-3">
                            <div class="pr-4">
                                <p class="font-semibold text-slate-800">${slot.time}</p>
                                <p class="text-sm text-slate-500">${slot.signedUp} of ${slot.needed} spots filled</p>
                            </div>
                            <button data-id="${slot.id}" class="signup-btn inline-flex items-center justify-center bg-teal-100 text-teal-800 font-bold py-2 px-4 rounded-lg hover:bg-teal-200 transition duration-300 text-sm flex-shrink-0 disabled:opacity-50" ${slot.signedUp >= slot.needed ? 'disabled' : ''}>
                                ${slot.signedUp >= slot.needed ? 'Full' : 'Sign Up'}
                            </button>
                        </div>
                    `).join('');
                    
                    return `
                        <div class="px-6 py-4 border-t border-slate-200 first:border-t-0">
                            <h4 class="text-lg font-bold text-slate-800">${group.title}</h4>
                            <p class="mt-1 text-sm text-slate-600">${group.description}</p>
                            <div class="mt-3 flex flex-wrap gap-x-4 gap-y-1 text-xs text-slate-500">
                                <span class="flex items-center"><i class="ph-calendar-blank mr-1"></i> ${formatDate(group.date)}</span>
                                <span class="flex items-center"><i class="ph-map-pin mr-1"></i> ${group.location}</span>
                                <span class="flex items-center"><i class="ph-star mr-1"></i> Semester: ${group.semester}</span>
                                <span class="flex items-center"><i class="ph-clock mr-1"></i> ${group.hours} hrs</span>
                            </div>
                            <div class="mt-3">
                                <h5 class="font-semibold text-slate-700 mb-1 text-sm">Available Time Slots:</h5>
                                <div class="space-y-1">${timeSlotsHtml}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden';
                card.innerHTML = `
                    <div class="p-4 cursor-pointer flex justify-between items-center volunteer-card-header bg-slate-50 hover:bg-slate-100 transition-colors" data-target="event-group-${index}">
                        <h3 class="text-xl font-bold text-slate-900">${eventName}</h3>
                        <i class="ph-caret-down text-2xl transition-transform text-slate-400"></i>
                    </div>
                    <div id="event-group-${index}" class="hidden">
                        ${eventContentHtml}
                    </div>
                `;
                list.appendChild(card);
            });
        }
        
        function renderMySignups(progress) {
            const container = document.getElementById('my-signups-content');
            if(!container) return;
            
            const selfReportFormHtml = `
            <form id="self-report-form">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                    <h3 class="text-xl font-semibold text-slate-800 mb-2">Self-Report Off-Portal Hours</h3>
                    <p class="text-sm text-slate-600 mb-4">Did you volunteer for a task not listed in the portal? Please submit for approval.</p>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="report-date" class="block text-sm font-medium text-slate-700">Date of Activity</label>
                                <input type="date" id="report-date" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:ring-teal-500 focus:border-teal-500" required>
                            </div>
                            <div>
                                <label for="report-duration" class="block text-sm font-medium text-slate-700">Duration</label>
                                <select id="report-duration" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:ring-teal-500 focus:border-teal-500" required>
                                    <option value="CUST-30M">30 Minutes</option>
                                    <option value="CUST-1H">1 Hour</option>
                                    <option value="CUST-2H">2 Hours</option>
                                    <option value="CUST-3H">3 Hours</option>
                                    <option value="CUST-4H">4 Hours</option>
                                    <option value="CUST-5H">5 Hours</option>
                                    <option value="CUST-6H">6 Hours</option>
                                    <option value="CUST-7H">7 Hours</option>
                                    <option value="CUST-8H">8 Hours</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="report-description" class="block text-sm font-medium text-slate-700">Brief Description & Verifier</label>
                            <textarea id="report-description" rows="3" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:ring-teal-500 focus:border-teal-500" required></textarea>
                        </div>
                        <button type="submit" id="self-report-btn" class="w-full sm:w-auto inline-flex items-center justify-center bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors disabled:bg-slate-400">Submit for Approval</button>
                    </div>
                </div>
            </form>`;
            
            const progressBarsHtml = `
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800">Semester 1 Progress</h3>
                        <div class="mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-base font-medium text-teal-700">Completed Hours</span>
                                <span class="text-sm font-medium text-teal-700" id="progress-text-s1">Loading...</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-5 relative overflow-hidden">
                                <div id="progress-bar-s1-inprogress" class="bg-orange-400 h-5 rounded-full" style="width: 0%"></div>
                                <div id="progress-bar-s1-completed" class="bg-teal-600 h-5 rounded-full absolute top-0 left-0" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span id="in-progress-text-s1"></span>
                                <span id="penalty-text-s1" class="text-red-600 font-semibold"></span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800">Semester 2 Progress</h3>
                        <div class="mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-base font-medium text-teal-700">Completed Hours</span>
                                <span class="text-sm font-medium text-teal-700" id="progress-text-s2">Loading...</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-5 relative overflow-hidden">
                                <div id="progress-bar-s2-inprogress" class="bg-orange-400 h-5 rounded-full" style="width: 0%"></div>
                                <div id="progress-bar-s2-completed" class="bg-teal-600 h-5 rounded-full absolute top-0 left-0" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span id="in-progress-text-s2"></span>
                                <span id="penalty-text-s2" class="text-red-600 font-semibold"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            
            const signupListsHtml = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-xl font-semibold text-slate-700 mb-2">Upcoming Signups</h3>
                    <p class="text-sm text-slate-600 mb-4">You may withdraw up to 3 weeks (21 days) before the event.</p>
                    <div id="upcoming-signups-list" class="space-y-4"></div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-slate-700 mb-4">Completed & Past Signups</h3>
                    <div id="completed-signups-list" class="space-y-4"></div>
                </div>
            </div>`;
            
            const matchingInfoHtml = getMatchingInfoHtml(portalData.mySignups);
            
            container.innerHTML = selfReportFormHtml + progressBarsHtml + signupListsHtml + matchingInfoHtml;
            
            if (progress) {
                const s1 = progress.semester1;
                const s1_req = s1.totalRequired || 1;
                const s1_completed_p = s1_req > 0 ? (s1.completed / s1_req) * 100 : 0;
                const s1_inprogress_p = s1_req > 0 ? (s1.inProgress / s1_req) * 100 : 0;
                
                document.getElementById('progress-bar-s1-completed').style.width = `${Math.min(s1_completed_p, 100)}%`;
                document.getElementById('progress-bar-s1-inprogress').style.width = `${Math.min(s1_completed_p + s1_inprogress_p, 100)}%`;
                document.getElementById('progress-text-s1').textContent = `${s1.completed} of ${s1.baseRequired} hours`;
                document.getElementById('in-progress-text-s1').textContent = `${s1.inProgress || 0} hours in progress`;
                document.getElementById('penalty-text-s1').textContent = s1.penalty > 0 ? `+ ${s1.penalty} penalty hours` : '';
                
                const s2 = progress.semester2;
                const s2_req = s2.totalRequired || 1;
                const s2_completed_p = s2_req > 0 ? (s2.completed / s2_req) * 100 : 0;
                const s2_inprogress_p = s2_req > 0 ? (s2.inProgress / s2_req) * 100 : 0;
                
                document.getElementById('progress-bar-s2-completed').style.width = `${Math.min(s2_completed_p, 100)}%`;
                document.getElementById('progress-bar-s2-inprogress').style.width = `${Math.min(s2_completed_p + s2_inprogress_p, 100)}%`;
                document.getElementById('progress-text-s2').textContent = `${s2.completed} of ${s2.baseRequired} hours`;
                document.getElementById('in-progress-text-s2').textContent = `${s2.inProgress || 0} hours in progress`;
                document.getElementById('penalty-text-s2').textContent = s2.penalty > 0 ? `+ ${s2.penalty} penalty hours` : '';
            }
        }
        
        function renderMySignupsList(signups) {
            const upcomingList = document.getElementById('upcoming-signups-list');
            const completedList = document.getElementById('completed-signups-list');
            if(!upcomingList || !completedList) return;
            
            upcomingList.innerHTML = '';
            completedList.innerHTML = '';
            
            if(!signups) return;

            const upcomingSignups = signups.filter(s => s.status === 'In Progress' || s.status === 'Pending Approval');
            const pastSignups = signups.filter(s => s.status === 'Completed' || s.status === 'Penalty' || s.status === 'Withdrawn');

            if (upcomingSignups.length === 0) {
                upcomingList.innerHTML = '<div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-slate-500">No upcoming volunteer signups.</div>';
            } else {
                upcomingSignups.forEach((signup) => {
                    const item = document.createElement('div');
                    item.className = 'bg-white p-5 rounded-lg shadow-sm border border-slate-200';
                    const eventDate = new Date(signup.date);
                    const daysUntilEvent = (eventDate - new Date()) / (1000 * 60 * 60 * 24);
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    
                    let actionButtonsHtml = '';
                    if (signup.status === 'Pending Approval') {
                        actionButtonsHtml = `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Pending Approval</span>`;
                    } else {
                        const withdrawButtonHtml = daysUntilEvent > 21 ? 
                            `<button data-signup-id="${signup.signupId}" class="withdraw-btn w-full text-sm bg-red-100 text-red-800 font-semibold py-2 px-4 rounded-lg hover:bg-red-200 transition">Withdraw</button>` : 
                            `<button class="w-full text-sm bg-slate-200 text-slate-500 font-semibold py-2 px-4 rounded-lg cursor-not-allowed" disabled>Withdrawal ended</button>`;
                        
                        let qrButtonHtml = '';
                        if (eventDate <= today) {
                            qrButtonHtml = `<button data-signup-id="${signup.signupId}" class="show-qr-btn w-full text-sm bg-slate-800 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-700 transition">Show Check-in Code</button>`;
                        } else {
                            qrButtonHtml = `<button class="w-full text-sm bg-slate-200 text-slate-500 font-semibold py-2 px-4 rounded-lg cursor-not-allowed" disabled>Code not yet available</button>`;
                        }
                        
                        const calendarButtonHtml = `
                            <div class="relative">
                                <button type="button" class="add-to-calendar-btn w-full inline-flex items-center justify-center rounded-md border border-slate-300 shadow-sm px-3 py-2 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none" data-event-name="${signup.title}" data-event-date="${signup.date}"><i class="ph-plus-circle mr-2"></i> Add to Calendar</button>
                                <div class="event-dropdown origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                                    <div class="py-1">
                                        <a href="#" class="google-cal-link text-slate-700 block px-4 py-2 text-sm hover:bg-slate-100">Google Calendar</a>
                                        <a href="#" class="ical-link text-slate-700 block px-4 py-2 text-sm hover:bg-slate-100">iCal/Outlook</a>
                                    </div>
                                </div>
                            </div>`;
                            
                        actionButtonsHtml = `<div class="mt-4 sm:mt-0 sm:ml-6 flex-shrink-0 flex flex-col space-y-2 w-full sm:w-48">${qrButtonHtml}${calendarButtonHtml}${withdrawButtonHtml}</div>`;
                    }
                    
                    item.innerHTML = `
                        <div class="flex flex-col sm:flex-row justify-between">
                            <div class="flex-grow">
                                <h4 class="text-lg font-bold text-slate-900">${signup.title}</h4>
                                <div class="mt-2 space-y-1">
                                    <div class="flex items-center text-sm text-slate-500"><i class="ph-info mr-2"></i><p>${signup.description || 'No description provided.'}</p></div>
                                    <div class="flex items-center text-sm text-slate-500"><i class="ph-calendar-blank mr-2"></i><p>${formatDate(signup.date)} at ${signup.time}</p></div>
                                    <div class="flex items-center text-sm text-slate-500"><i class="ph-map-pin mr-2"></i><p>${signup.location}</p></div>
                                </div>
                            </div>
                            ${actionButtonsHtml}
                        </div>`;
                    upcomingList.appendChild(item);
                });
            }

            if (pastSignups.length === 0) {
                completedList.innerHTML = '<div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-slate-500">No completed or past signups.</div>';
            } else {
                pastSignups.forEach(signup => {
                    const item = document.createElement('div');
                    item.className = 'bg-white p-4 rounded-lg shadow-sm border border-slate-200';
                    const statusColor = signup.status === 'Completed' ? 'text-green-700 bg-green-100' : signup.status === 'Penalty' ? 'text-red-700 bg-red-100' : 'text-slate-700 bg-slate-100';
                    item.innerHTML = `
                        <div class="flex flex-col sm:flex-row justify-between">
                            <div>
                                <h4 class="text-md font-bold text-slate-900">${signup.title}</h4>
                                <p class="mt-1 text-sm text-slate-600">${signup.description || ''}</p>
                                <div class="mt-2 text-sm text-slate-500">
                                    <p><i class="ph-calendar-blank mr-1"></i> ${formatDate(signup.date)} at ${signup.time}</p>
                                </div>
                            </div>
                            <div class="mt-3 sm:mt-0 sm:ml-6 flex-shrink-0 text-left sm:text-right">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">${signup.status}</span>
                            </div>
                        </div>`;
                    completedList.appendChild(item);
                });
            }
        }
    </script>
</body>
</html>
